<div class="container">
 <div class="row">
  <div class="col-xs-12 col-sm-6">
    <div class="bigcard">

     <p><%=@challenge.address%></p>
     <div class="inlining">
      <div class="score">
       <p><b><%= @challenge.score %><sup>PT</sup></b></p></div>
       <p><%= @challenge.cost %></p>
       <i class="fa fa-map-marker" aria-hidden="true"></i>
     </div>
     <h2><%= @challenge.title.capitalize %></h2>
     <div class="col-xs-6">
       <p><%= image_tag(@challenge.picture, :class => "picture-challenge") %></p>
     </div>
     <div class="col-xs-6 col-xs-offset-6">
       <p><%= @challenge.description %></p>
     </div>

     <% if @answer.not_completed? %>
     <div class= "alert alert-warning">
       wrong answer
     </div>
     <% end %>
      <div class="needlilspace styled-input">
     <%= simple_form_for [@team, @challenge, @answer], defaults: { input_html: { class: 'input-container' } } do |f| %>
       <%= f.error_notification %>
       <% if @challenge.answer_text? %>
       <%= f.input :text, input_html: {value: @answer.text}, label: 'Your answer', wrapper: :p_wrapper %>
       <% elsif @challenge.answer_picture? %>
       <%= f.input :picture %>
       <%= f.input :picture_cache, as: :hidden %>
       <% elsif @challenge.answer_auto? %>
       <%= f.input :text, label: false,
       collection: bad_answers(@challenge),
       include_blank: "-- Choose an answer --",
       selected: @answer.text,
       input_html: { class: "disable-form-control" } %>
       <% else @challenge.answer_both? %>
       <%= f.input :text, label: 'Your answer', wrapper: :p_wrapper %>
       <%= f.input :picture %>
       <%= f.input :picture_cache, as: :hidden %>
       <% end %>
       <div class="lilspace">
         <%= f.button :submit %>
         <% end %>
       </div>
     </div>

       <%= link_to "#myModal", "data-toggle" => "modal" do %>
       <p> want a hint?</i></p>
       <% end %>
       <div id="myModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">Your hint is : </h4>
            </div>
            <div class="modal-body">
              <p><%= @challenge.hint %></p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <div class= "top-right">
      <div class="cross-back">

        <%= link_to '', team_challenges_path(@team, @challenge), class: "fa fa-times fa-lg", style: "color: #516DAC;" %>
      </div>

    </div>
  </div>
</div>
</div>


<div class="distance" id="total-distance">Total distance : </div>
</div>

<div id="map" style="width: 100%; height: 600px;"></div>

<% content_for(:after_js) do %>
<%= javascript_tag do %>
function initMap() {

var map = new google.maps.Map(document.getElementById('map'), {
center: {lat: 50.8503, lng: 4.3517},
zoom: 12
});
var infoWindow = new google.maps.InfoWindow({map: map});
var icon = "<%= asset_path 'map-marker-2.png' %>"
var challenge = new google.maps.Marker({
position: new google.maps.LatLng(<%=@challenge.latitude %>, <%=@challenge.longitude%>),
map: map,
icon: icon,
});




// Try HTML5 geolocation.
if (navigator.geolocation) {
navigator.geolocation.getCurrentPosition(function(position) {
var userPosition = {
lat: 50.847619,
lng: 4.359196
};

var challengePosition = {
lat: <%=@challenge.latitude %>,
lng: <%=@challenge.longitude%>
};

console.log(userPosition.lng)
console.log(challengePosition.lng)
console.log(getDistanceFromLatLonInKm(userPosition.lat, userPosition.lng,challengePosition.lat,challengePosition.lng))

totalDistance = getDistanceFromLatLonInKm(userPosition.lat, userPosition.lng,challengePosition.lat,challengePosition.lng).toFixed(3)
totalDistance = totalDistance.toString()
totalDistance = totalDistance.replace('.', ',')

$("#total-distance").append( totalDistance + ' km ')

infoWindow.setPosition(userPosition);
infoWindow.setContent('here you are');
map.setCenter(userPosition);
}, function() {
handleLocationError(true, infoWindow, map.getCenter());
});
} else {
// Browser doesn't support Geolocation
handleLocationError(false, infoWindow, map.getCenter());
}
}

function handleLocationError(browserHasGeolocation, infoWindow, userPosition) {
infoWindow.setPosition(userPosition);
infoWindow.setContent(browserHasGeolocation ?
'Error: The Geolocation service failed.' :
'Error: Your browser doesn\'t support geolocation.');
}


<% end %>

<% end %>

<!-- for admin only: update or download the challenge picture
-->
<div>
 <% if current_user.admin? %>
 <%= simple_form_for [@team, @challenge], url:  team_challenge_path(@team, @challenge) do |c| %>
 <%= c.input :picture %>
 <%= c.input :picture_cache, as: :hidden %>

 <%= c.button :submit %>
 <% end %>

 <% end %>
</div>
